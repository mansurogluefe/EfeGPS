<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EfeGPS - Gelişmiş Rota Analizi</title>

    <!-- CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-polylinedecorator@1.6.0/dist/leaflet.polylineDecorator.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body data-theme="light">

<div id="map"></div>

<div id="chart-container">
    <canvas id="analyticsChart"></canvas>
</div>

<div id="loading-overlay">
    <p>Veriler yükleniyor...</p>
</div>

<div id="sidebar" class="open">
    <div id="sidebar-content">
        <h3>Gelişmiş Analiz Paneli</h3>
        <div class="tab-buttons">
            <div class="tab-button active" onclick="openTab('summary')">Özet</div>
            <div class="tab-button" onclick="openTab('stops')">Duraklamalar</div>
            <div class="tab-button" onclick="openTab('analysis')">Detaylı Analiz</div>
            <div class="tab-button" onclick="openTab('settings')">Ayarlar</div>
        </div>

        <div id="summary" class="tab-content active">
            <h4>Yolculuk Özeti</h4>
            <p><strong>Toplam Mesafe:</strong> <span id="total-distance">-</span></p>
            <p><strong>Maksimum Hız:</strong> <span id="max-speed">-</span></p>
            <p><strong>Ortalama Hız:</strong> <span id="avg-speed">-</span></p>
            <p><strong>Toplam Süre:</strong> <span id="total-time">-</span></p>
            <p><strong>Sürüş Süresi:</strong> <span id="drive-time">-</span></p>
            <p><strong>Sürüş Puanı:</strong> <span id="driving-score">-</span></p>
        </div>

        <div id="stops" class="tab-content">
            <h4>Duraklama Noktaları (<span id="stop-count">0</span>)</h4>
            <div id="stops-summary">
                <p><strong>Toplam Duraklama:</strong> <span id="total-stop-time">-</span></p>
                <p><strong>Ortalama Duraklama:</strong> <span id="avg-stop-time">-</span></p>
            </div>
            <ul id="stops-list"></ul>
        </div>

        <div id="analysis" class="tab-content">
            <h4>Detaylı Analiz</h4>
            <div class="analysis-section">
                <h5>📊 Performans Metrikleri</h5>
                <p><strong>Rota Verimliliği:</strong> <span id="route-efficiency">-</span></p>
                <p><strong>Hız Değişkenliği:</strong> <span id="speed-variation">-</span></p>
                <p><strong>Sabit Hız Oranı:</strong> <span id="constant-speed">-</span></p>
            </div>
            <div class="analysis-section">
                <h5>⛽ Yakıt & Maliyet (Tahmini)</h5>
                <p><strong>Yakıt Tüketimi:</strong> <span id="fuel-consumption">-</span></p>
                <p><strong>CO2 Salınımı:</strong> <span id="co2-emissions">-</span></p>
                <p><strong>Yakıt Maliyeti:</strong> <span id="fuel-cost">-</span></p>
            </div>
            <div class="analysis-section">
                <h5>⚠️ Uyarılar</h5>
                <div id="alerts-list"></div>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <h4>Ayarlar</h4>
            <p><label>Tarih Seç: <input type="date" id="datePicker"></label></p>
            <p><label>Hız Limiti (km/s): <input type="number" id="speedLimit" value="60" min="1"></label></p>
            <p><label>Ort. Yakıt Tüketimi (L/100km): <input type="number" id="fuelConsumption" value="7" min="1" step="0.1"></label></p>
            <p><label>Yakıt Fiyatı (TL/L): <input type="number" id="fuelPrice" value="22" min="1" step="0.1"></label></p>
            <p><label>Tema:
                <select id="themeSelect">
                    <option value="light" selected>Açık</option>
                    <option value="dark">Koyu</option>
                </select>
            </label></p>
            <p>
                <button id="exportJSON">JSON İndir</button>
                <button id="exportGPX">GPX İndir</button>
                <button id="exportReport">Rapor İndir</button>
            </p>
        </div>
    </div>
    <div id="toggle-btn" onclick="toggleSidebar()">«</div>
</div>

<!-- JS -->
<script src="main.js"></script>
</body>
</html>